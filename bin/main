#!/usr/bin/env ruby
require_relative('../lib/crawler.rb')
require_relative('../lib/walmart.rb')
require_relative('../lib/files_generator.rb')

files_generator = FilesGenerator.new

puts 'ğŸ“¦ Verifying bar codes input files'
bar_codes = files_generator.read_input_csv
walmart = WalmartMx.new(bar_codes)
puts "ğŸ‘€ #{bar_codes.length} bar code(s) detected"

puts 'âš¡ Started crawling'
walmart.bar_code_loop
crawled_products = walmart.crawled_products
crawler_errors = walmart.crawler_errors
puts "ğŸ Finished: #{walmart.crawled_counter} out of #{bar_codes.length} products crawled."

puts 'ğŸ“‚ Generating output file'
files_generator = FilesGenerator.new
files_generator.generate_output_csv(crawled_products)
puts 'âœ… Sucessful Crawls'
puts files_generator.table_generator(crawled_products)
puts 'âŒ Crawling errors'
puts files_generator.table_errors(crawler_errors)
